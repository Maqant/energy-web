// import { take, call, put, select } from 'redux-saga/effects';
import { /* take, select, */ call, takeLatest, put } from 'redux-saga/effects';
import { ExcelRenderer } from 'react-excel-renderer';

import { LOAD_EXCEL } from './constants';
import { loadExcelSuccess, loadExcelFailure } from './actions';

// Individual exports for testing

const loadFile = fileObj =>
  new Promise((resolve, reject) => {
    ExcelRenderer(fileObj, (err, resp) => {
      if (err) reject(err);
      const respTemp = resp;
      respTemp.cols['0'].name = 'Tarih';
      respTemp.cols['1'].name = 'Saat';
      respTemp.cols['2'].name = 'TÃ¼ketim';
      respTemp.cols.push({
        name: 'Tahmin',
        key: 3,
      });
      const dataTable = { cols: respTemp.cols, rows: respTemp.rows };
      const tahminData = [
        1576366.3715616176,
        1465386.2126431675,
        1404836.894337901,
        1389393.6511787507,
        1399027.3745661408,
        1432149.2799127288,
        1464446.997716482,
        1596550.4376094425,
        1966693.052020098,
        2162222.882813539,
        2263199.8787153093,
        2293027.9137287685,
        2135600.7826888557,
        2203060.8265918274,
        2210348.7417680416,
        2201559.184801061,
        2194235.340874114,
        2150924.0902783615,
        2220855.5684116925,
        2207628.0007746457,
        2114337.7395662614,
        2003050.815574353,
        1921045.8580435729,
        1797322.0135340802,
        1640534.0404320692,
        1519048.6193974568,
        1458224.4426877364,
        1440199.9783891942,
        1444581.6522242953,
        1457787.0395689816,
        1468622.5415936187,
        1568014.2315587678,
        1913123.7277286912,
        2105979.6425903854,
        2209443.946446105,
        2249560.2865337254,
        2137958.2262078924,
        2226682.7825739873,
        2251419.900521105,
        2221575.638726968,
        2188532.0843631933,
        2137080.0555440136,
        2235080.1831109975,
        2227941.064190711,
        2130345.9969441337,
        2042812.727881618,
        1949273.450663093,
        1818358.8716715665,
        1657785.1020269636,
        1544367.326209047,
        1499445.6714713196,
        1484282.4925780017,
        1495628.7782142204,
        1517438.9559830981,
        1540398.6876309314,
        1669492.585832405,
        2028646.0006993902,
        2212134.9752625935,
        2302981.5068380055,
        2352018.090396719,
        2245304.9656000473,
        2359822.728850821,
        2399968.2273003086,
        2385494.04969851,
        2356565.936434634,
        2275885.3860363783,
        2356968.670731872,
        2327873.083799837,
        2199605.3668753426,
        2104480.7491067564,
        2013197.011709198,
        1878273.5456315088,
        1708195.368411404,
        1593979.6835743107,
        1533363.6859382037,
        1500830.8182683787,
        1515192.682180023,
        1545908.8149919563,
        1573290.4828283137,
        1719171.8163637733,
        2064547.4379672357,
        2236758.2842189493,
        2339502.175086337,
        2374693.8533826866,
        2251806.435728417,
        2376198.6796099343,
        2435431.441110871,
        2435305.25435396,
        2421567.1523220995,
        2338598.4458583533,
        2404843.2395732254,
        2351953.820161303,
        2239696.079171978,
        2139854.9561869977,
        2049833.7457445806,
        1908552.9260573597,
      ];

      dataTable.rows.map((row, index) =>
        row.push(tahminData[index].toString()),
      );
      resolve(dataTable);
    });
  });

export function* sendLoadRequest(action) {
  const fileObj = action.event.target.files[0];
  try {
    const dataTable = yield call(loadFile, fileObj);
    yield put(loadExcelSuccess(dataTable));
  } catch (err) {
    yield put(loadExcelFailure(err));
  }
}

export default function* watchSelectExcel() {
  yield takeLatest(LOAD_EXCEL, sendLoadRequest);
}
